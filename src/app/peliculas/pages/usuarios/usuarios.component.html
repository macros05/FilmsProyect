<div class="usuarios-container" *ngIf="isSuperAdmin">
  <button mat-raised-button color="primary" (click)="showForm()">Agregar Usuario</button>
  <div *ngIf="userFormVisible">
    <h2>{{ currentUser ? 'Editar Usuario' : 'Agregar Usuario' }}</h2>
    <form [formGroup]="usuarioForm!">
      <mat-form-field>
        <mat-label>Usuario</mat-label>
        <input matInput formControlName="usuario">
        <mat-error *ngIf="usuarioForm?.get('usuario')?.hasError('required')">El usuario es obligatorio.</mat-error>
        <mat-error *ngIf="usuarioForm?.get('usuario')?.hasError('email')">Debe ser un email válido.</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Contraseña</mat-label>
        <input matInput type="password" formControlName="password">
        <mat-error *ngIf="usuarioForm?.get('password')?.hasError('required')">La contraseña es obligatoria.</mat-error>
        <mat-error *ngIf="usuarioForm?.get('password')?.hasError('minlength')">La contraseña debe tener al menos 6 caracteres.</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Nombre Público</mat-label>
        <input matInput formControlName="nombre_publico">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Rol</mat-label>
        <mat-select formControlName="id_rol">
          <mat-option *ngFor="let rol of roles" [value]="rol.id_rol">{{ rol.rol }}</mat-option>
        </mat-select>
        <mat-error *ngIf="usuarioForm?.get('id_rol')?.hasError('required')">El rol es obligatorio.</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Observaciones</mat-label>
        <input matInput formControlName="observaciones">
      </mat-form-field>
      <button mat-raised-button color="accent" (click)="saveUser()" [disabled]="!usuarioForm?.valid">Guardar</button>
      <button mat-raised-button color="warn" (click)="resetForm()">Cancelar</button>
    </form>
  </div>
  <div *ngIf="!userFormVisible">
    <table mat-table [dataSource]="users">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let user"> {{user.id_usuario}} </td>
      </ng-container>
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Email </th>
        <td mat-cell *matCellDef="let user"> {{user.usuario}} </td>
      </ng-container>
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef> Usuario </th>
        <td mat-cell *matCellDef="let user"> {{user.nombre_publico}} </td>
      </ng-container>
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef> Rol </th>
        <td mat-cell *matCellDef="let user"> {{user.rol?.rol || 'Sin rol asignado'}} </td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let user">
          <button mat-icon-button (click)="showForm(user)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteUser(user.id_usuario)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>
<div *ngIf="!isSuperAdmin" class="access-denied">
  <mat-card>
    <mat-card-content>
      <h2>Acceso Denegado</h2>
      <p>No tienes permisos para acceder a esta sección.</p>
      <button mat-raised-button color="primary" routerLink="/peliculas/list">Volver al listado</button>
    </mat-card-content>
  </mat-card>
</div>
